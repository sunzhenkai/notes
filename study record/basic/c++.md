---
title: 研习录 - C++ 基础
categories: 
    - 研习录
tags:
    - 研习录
date: 2023/12/24 00:00:00
---

# 关键词

## virtual

- **作用** 
    - 定义**虚函数**
    - 仅定义未实现的函数为**纯虚函数**
    - 有纯虚函数的类，叫**抽象类**，无法直接实例化
    
- **原理** 
    - 虚函数是通过在类的**虚函数表（vtable）**中存储**函数指针**来实现的
        - 编译器会为包含虚函数的类创建一个**虚函数表**和指向虚函数表的**虚函数指针（vptr）**，虚函数表是一个指向虚函数的**指针数组**
        - 每个定义虚函数的类都有自己的虚函数表，包含该类所定义的虚函数地址
        - 当派生类重写（Override）基类的虚函数时，会在其自己的虚函数表中存储该虚函数的新地址，覆盖了基类虚函数表中相应位置的函数指针
        - 每个派生类都有自己独立的虚函数表，其中存储着派生类覆盖（Override）或新增的虚函数的地址
        - 当通过指向基类的**指针或引用**调用虚函数时，会通过虚函数指针查找对应的虚函数表完成调用，这个过程是在运行时动态决定的，被称为**动态绑定**


- 注意
    - 基类不可以是虚函数，析构函数在有资源释放时必须是虚函数
        - 虚函数通过查找虚函数表调用的，而虚函数是内存中的一片区域，需要先构造对象并创建内存空间，才能完成虚函数的调用，所以构造函数不能为虚函数
        - 析构函数，在存在释放内存空间的代码时，必须设置为虚函数，负责会存在因虚构函数无法调用导致的内存泄露问题
