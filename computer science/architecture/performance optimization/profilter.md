---
title: 性能分析
categories: 
    - [架构, 性能优化]
tags:
    - 性能分析
date: 2022/01/26 00:00:00
update: 2022/01/26 00:00:00
---

# 指标

- 通量（Throughput，或吞吐量）
- 时延（Latency）

# 通量

## 性能瓶颈排查

- 处理器占用率
  - 使用 top 命令查看
  - 如果处理器占用率未满，排查网络、任务调度、IO 空洞问题
  - 如果处理器占满，使用 perf、ftrace 等工具进一步排查

- 流控（网卡）

  - 查看网卡丢包，可以通过增加缓冲区降低丢包率

    ```shell
    wlan0     Link encap:以太网  硬件地址 7c:7a:91:xx:xx:xx  
              inet 地址:192.168.0.103  广播:192.168.0.255  掩码:255.255.255.0
              inet6 地址: fe80::7e7a:91ff:fefe:5a1a/64 Scope:Link
              UP BROADCAST RUNNING MULTICAST  MTU:1500  跃点数:1
              接收数据包:113832 错误:0 丢弃:0 过载:0 帧数:0
              发送数据包:81183 错误:0 丢弃:0 过载:0 载波:0
              碰撞:0 发送队列长度:1000 
              接收字节:47850861 (47.8 MB)  发送字节:18914031 (18.9 MB)
    ```

- 任务调度缺陷
  - 线程数远小于核心数，不能充分利用多核
- IO 空洞
  - 同步等待 IO 操作，可以通过异步解决

# 参考

- https://zhuanlan.zhihu.com/p/22124514